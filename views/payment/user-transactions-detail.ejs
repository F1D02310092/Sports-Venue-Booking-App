<% layout('layout/boilerplate.ejs') %>

<style>
  #receipt-content {
    border: 1px solid #ccc;
    padding: 20px;
    width: 420px;
    background: #fff;
    font-family: "Courier New", monospace;
    margin-bottom: 24px;
  }

  #receipt-content h1,
  #receipt-content h2 {
    margin: 0;
    font-family: "Courier New", monospace;
  }

  .receipt-badge {
    display: inline-block;
    padding: 2px 6px;
    border-radius: 4px;
    background: #28a745;
    color: #fff;
    font-family: "Courier New", monospace;
    font-size: 13px;
  }

  .receipt-row {
    display: flex;
    justify-content: space-between;
    width: 100%;
    margin: 2px 0;
    font-family: "Courier New", monospace;
  }

  .receipt-title {
    font-weight: bold;
    margin-top: 10px;
  }

  .download-buttons button {
    font-family: monospace;
    padding: 6px 12px;
  }
</style>

<div class="container">
  <div class="row d-flex justify-content-center align-items-center">
    <div class="col-lg-12" style="width: fit-content">
      <div class="download-buttons d-flex justify-content-evenly mb-3">
        <button onclick="downloadPDF('<%= booking.orderID%>', this)">Download PDF</button>
        <button onclick="downloadJPG('<%= booking.orderID%>', this)">Download JPG</button>
      </div>

      <div id="receipt-content">
        <div class="text-center" style="border-bottom: 2px solid black">
          <h1>PAYMENT DETAILS</h1>
          <h2>GOR FUTSAL</h2>
          <p>Jln. Kita Masih Panjang, No. 123, Jakarta</p>
          <p>Telp: (123) 1234-1234</p>
        </div>

        <div class="py-3" style="border-bottom: 2px solid black">
          <div class="receipt-row"><span>Customer:</span><span><%= booking.user.username %></span></div>
          <div class="receipt-row"><span>Email:</span><span><%= booking.user.email %></span></div>
        </div>

        <div class="my-3">
          <div class="receipt-row"><span>Field:</span><span><%= booking.field.name %></span></div>
          <div class="receipt-row"><span>Date:</span><span><%= formattedDate(booking.date) %></span></div>
          <div class="receipt-row">
            <span>Status:</span>
            <span class="receipt-badge"><%= booking.status %></span>
          </div>

          <p class="receipt-title">Playing Session(s):</p>

          <% booking.slots.forEach((sess, idx) => { %>
          <div class="receipt-row">
            <span>Slot <%= idx + 1 %>: <%= minutesToHHMM(sess) %> - <%= minutesToHHMM(sess + 60) %></span>
            <span>Rp<%= formatPrice(booking.totalPrice / booking.slots.length) %></span>
          </div>
          <% }) %>
        </div>

        <div class="receipt-row receipt-title" style="border-top: 2px solid black">
          <span>Total:</span>
          <span>Rp<%= formatPrice(booking.totalPrice) %></span>
        </div>

        <div class="receipt-title mt-4">Payment Info</div>
        <div class="receipt-row"><span>Method:</span><span>Midtrans Gateway</span></div>
        <hr />
        <div class="receipt-row" style="flex-direction: column; align-items: flex-start">
          <span>Order ID:</span>
          <span><%= booking.orderID %></span>
        </div>
        <hr />

        <div class="receipt-row" style="flex-direction: column; align-items: flex-start">
          <span>Paid At:</span>
          <span style="text-align: right"> <%= booking.paymentTime.toLocaleString("en-CA", { weekday: "long", year: "numeric", month: "long", day: "numeric", hour: "numeric", minute: "numeric", second: "numeric", hour12: false }) %> </span>
        </div>
        <hr />

        <% if(currUser && currUser.role === 'user'){ %>
        <p class="text-center mt-3">Thank you for using our services!</p>
        <% } %>
      </div>

      <% if(currUser && currUser.role === 'admin'){ %>
      <div class="d-flex justify-content-evenly mt-3">
        <a class="btn btn-info" target="_blank" href="https://dashboard.sandbox.midtrans.com/beta/transactions?detail=<%= booking.transactionID %>"> Verify Status </a>
      </div>
      <% } %>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="/js/receiptDownload.js"></script>